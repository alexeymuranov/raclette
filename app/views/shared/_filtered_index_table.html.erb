<%= form_tag nil, :method => :get do %>
  <%= content_tag :table, :id => table_name, :class => (filter.blank? ? 'records' : 'filtered records') do %>
    <colgroup class="attributes">
      <% attributes.size.times do %><col /><% end %>
    </colgroup>
    <colgroup><col /><col /></colgroup>
    <thead>
      <tr>
        <% column_types_o_hash.each do |attr, col_type| %>
          <%- if col_type == :boolean -%>
            <th class="boolean">
              <%= sortable table_name, attr, model_class.human_attribute_name(attr) %>
            </th>
          <%- else -%>
            <th>
              <%= sortable table_name, attr, model_class.human_attribute_name(attr) %>
            </th>
          <%- end -%>
        <% end %>
        <th class="empty"></th>
        <th class="empty"></th>
      </tr>
      <% unless filter.blank? %>
        <tr class="filter_values">
          <% column_types_o_hash.each do |attr, col_type| %>
            <% unless filter[attr].nil? %>
              <%- case col_type -%>
              <%- when :string -%>
                <td class="value">
                  <%= filter[attr] %>
                </td>
              <%- when :boolean -%>
                <td class="boolean value">
                  <%= boolean_to_yes_no(filter[attr]) %>
                </td>
              <% end %>
            <% else %>
              <td></td>
            <% end %>
          <% end %>
          <td class="empty"></td>
          <td class="empty"></td>
        </tr>
      <% end %>
      <tr class="form_fields">
        <% column_types_o_hash.each do |attr, col_type| %>
          <td class="field">
            <%- case col_type -%>
            <%- when :string -%>
              <%= text_field_tag "filter[#{attr}]", filter[attr] %>
            <%- when :boolean -%>
              <%= radio_button_tag "filter[#{attr}]", 'yes', filter[attr] %>
              <%= label_tag 'filter_'+attr.to_s+'_yes', t('yes') %>
              <br />
              <%= radio_button_tag "filter[#{attr}]", 'no', filter[attr] == false %>
              <%= label_tag 'filter_'+attr.to_s+'_no', t('no') %>
              <br />
              <%= radio_button_tag "filter[#{attr}]", 'all', filter[attr].nil? %>
              <%= label_tag 'filter_'+attr.to_s+'_all', t('all') %>
            <%- end -%>
          </td>
        <% end %>
        <td class="empty"></td>
        <td class="empty"></td>
      </tr>
      <tr class="form_actions">
        <%= content_tag :td, :colspan => attributes.size, :class => 'actions' do %>
          <%= submit_tag t('buttons.filter') %>
        <% end %>
        <td class="empty"></td>
        <td class="empty"></td>
      </tr>
    </thead>

    <tbody>
      <%= render :partial => 'shared/model_in_index',
                 :collection => models,
                 :as => :model,
                 :locals => { :attributes => attributes,
                              :column_types_o_hash => column_types_o_hash,
                              :edit_path_helper_method => edit_path_helper_method } %>
    </tbody>
  <% end %>
<% end %>
