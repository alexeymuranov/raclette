<%# Locals:
      form_builder:
      attribute:
      column_type (optional):
      # field_labels (optional):
      input_html_options (optional):
-%>

<% input_html_options = {} unless local_assigns.has_key? :input_html_options %>

<% model = form_builder.object %>
<% klass = model.class %>

<% unless local_assigns.has_key?(:column_type) %>
  <% unless (column = columns_hash[attribute.to_s]).nil? %>
    <% column_type = column.type %>
  <% else %>
    <% column_type = nil %>
  <% end %>
<% end %>

<% if input_html_options[:class].blank? %>
  <% input_css_classes = [] %>
<% else %>
  <% input_css_classes = input_html_options[:class].split(' ') %>
<% end %>

<% input_parent_css_classes = [] %>

<% if klass.validators_on(attribute).map(&:class).include?(
          ActiveModel::Validations::PresenceValidator) %>
  <% input_css_classes << 'required' %>
  <% input_html_options[:required] = 'required' %>
<% end %>

<% if readonly = klass.readonly_attributes.include?(attribute.to_s) %>
  <% input_css_classes << 'readonly' %>
<% end %>

<% editable = !readonly || model.new_record? %>

<% input_html_options[:class] = input_css_classes.join(' ') %>

<div class="item field">
  <dt>
    <% human_name = klass.human_attribute_name(attribute) %>

    <%- case column_type -%>
    <%- when :boolean, :delegated_boolean, :virtual_boolean -%>
      <%- label_content = t('formats.attribute_name?', :attribute => human_name) -%>
    <%- else -%>
      <%- label_content = t('formats.attribute_name:', :attribute => human_name) -%>
    <%- end -%>

    <%- if editable -%>
      <%= form_builder.label attribute, label_content -%>
    <%- else -%>
      <b><%= label_content -%></b>
    <%- end -%>
  </dt>

  <%- if [ :text, :delegated_text, :virtual_text ].include? column_type -%>
    <%- input_parent_css_classes << 'long_text' -%>
  <%- end -%>

  <%= content_tag :dd, :class => input_parent_css_classes.join(' ') do -%>
    <%- if editable -%>
      <%- case column_type -%>
      <%- when :boolean, :delegated_boolean, :virtual_boolean -%>
        <%= form_builder.check_box attribute, input_html_options -%>
      <%- when :integer, :delegated_integer, :virtual_integer -%>
        <%= form_builder.number_field attribute, input_html_options -%>
      <%- when :date, :delegated_date, :virtual_date -%>
        <%- input_html_options[:type] = 'date' -%>
        <%= form_builder.text_field attribute, input_html_options -%>
      <%- when :datetime, :delegated_datetime, :virtual_datetime -%>
        <%- input_html_options[:type] = 'datetime-local' -%>
        <%= form_builder.text_field attribute, input_html_options -%>
      <%- when :text, :delegated_text, :virtual_text -%>
        <%= form_builder.text_area attribute, input_html_options -%>
      <%- else -%>
        <%= form_builder.text_field attribute, input_html_options -%>
      <%- end -%>
    <%- else -%>
      <%- value = model.public_send(attribute) -%>

      <%- case column_type -%>
      <%- when :boolean, :delegated_boolean, :virtual_boolean -%>
        <%= boolean_to_picto(value, size=2) %>
      <%- when :date, :delegated_date, :virtual_date -%>
        <%= l value, :format => :long %>
      <%- when :datetime, :delegated_datetime, :virtual_datetime -%>
        <%= l value, :format => :custom %>
      <%- else -%>
        <%= value %>
      <%- end -%>
    <%- end -%>
  <%- end -%>
</div>
